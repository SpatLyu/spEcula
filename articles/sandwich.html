<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spEcula">
<title>Spatial prediction based on spatial stratified heterogeneity • spEcula</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial prediction based on spatial stratified heterogeneity">
<meta property="og:description" content="spEcula">
<meta property="og:image" content="https://spatlyu.github.io/spEcula/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spEcula</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/GOS.html">Geographically Optimal Similarity Model</a>
    <a class="dropdown-item" href="../articles/sandwich.html">Spatial prediction based on spatial stratified heterogeneity</a>
    <a class="dropdown-item" href="../articles/ssh-test.html">Spatial Stratified Heterogeneity Test</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SpatLyu/spEcula/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial prediction based on spatial stratified heterogeneity</h1>
                        <h4 data-toc-skip class="author">Wenbo Lv</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SpatLyu/spEcula/blob/HEAD/vignettes/sandwich.Rmd" class="external-link"><code>vignettes/sandwich.Rmd</code></a></small>
      <div class="d-none name"><code>sandwich.Rmd</code></div>
    </div>

    
    
<p>This vignette explains how to do spatial prediction use
<code>Sandwich Mapping Model</code> in <code>spEcula</code> package.</p>
<div class="figure" style="text-align: center">
<img src="../reference/figures/sandwich_flowchart.png" alt="Conceptual model of the Sandwich mapping model" width="100%"><p class="caption">
Conceptual model of the Sandwich mapping model
</p>
</div>
<div class="section level3">
<h3 id="load-package-and-data">Load package and data<a class="anchor" aria-label="anchor" href="#load-package-and-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SpatLyu/spEcula" class="external-link">spEcula</a></span><span class="op">)</span></span>
<span><span class="va">simpath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sim.gpkg"</span>, package<span class="op">=</span><span class="st">"spEcula"</span><span class="op">)</span></span>
<span><span class="va">sampling</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">simpath</span>,layer <span class="op">=</span> <span class="st">'sim_sampling'</span><span class="op">)</span></span>
<span><span class="va">ssh</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">simpath</span>,layer <span class="op">=</span> <span class="st">'sim_ssh'</span><span class="op">)</span></span>
<span><span class="va">reporting</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">simpath</span>,layer <span class="op">=</span> <span class="st">'sim_reporting'</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/sandwich_sim_data.png" alt="(a) A simulated data set that contains a 20 × 20 grid. The grid is divided into four strata (denoted by thick gray outlines), and a random sample of 41 units is drawn (as denoted by the dots). (b) Seven reporting units whose values are to be inferred. Gray units do not have sampling units falling in." width="100%"><p class="caption">
</p>
<ol style="list-style-type: lower-alpha"><li>A simulated data set that contains a 20 × 20 grid. The grid is
divided into four strata (denoted by thick gray outlines), and a random
sample of 41 units is drawn (as denoted by the dots). (b) Seven
reporting units whose values are to be inferred. Gray units do not have
sampling units falling in.

</li></ol>
</div>

</div>
<div class="section level3">
<h3 id="visualize-the-mean-and-standard-deviation-of-the-sample-in-each-stratum">visualize the mean and standard deviation of the sample in each
stratum<a class="anchor" aria-label="anchor" href="#visualize-the-mean-and-standard-deviation-of-the-sample-in-each-stratum"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampling_zone</span> <span class="op">=</span> <span class="va">sampling</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">ssh</span><span class="op">[</span><span class="st">'X'</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggerrorplot.html" class="external-link">ggerrorplot</a></span><span class="op">(</span><span class="va">sampling_zone</span>, x <span class="op">=</span> <span class="st">"X"</span>, y <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>            desc_stat <span class="op">=</span> <span class="st">"mean_sd"</span>, color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            add <span class="op">=</span> <span class="st">"violin"</span>, add.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">sampling_zone</span>,vmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>,.by <span class="op">=</span> <span class="va">X</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">vmean</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vmean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"black"</span>,size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sandwich_files/figure-html/sandwich_sample_distribution-1.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="run-sandwich-model-for-the-sim-data-use-area-weight">Run sandwich model for the sim data use <code>area</code>
weight<a class="anchor" aria-label="anchor" href="#run-sandwich-model-for-the-sim-data-use-area-weight"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_est</span> <span class="op">=</span> <span class="fu"><a href="../reference/sandwich.html">sandwich</a></span><span class="op">(</span>sampling <span class="op">=</span> <span class="va">sampling</span>,stratification <span class="op">=</span> <span class="va">ssh</span>,reporting <span class="op">=</span> <span class="va">reporting</span>,</span>
<span>                   sampling_attr <span class="op">=</span> <span class="st">'Value'</span>,ssh_zone <span class="op">=</span> <span class="st">'X'</span>,reporting_id <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                   weight_type <span class="op">=</span> <span class="st">'area'</span><span class="op">)</span></span>
<span><span class="va">sim_est</span></span>
<span><span class="co">## Simple feature collection with 7 features and 3 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 5.684342e-14 ymin: 2 xmax: 4 ymax: 6</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">##       Y sandwichest_mean sandwichest_standarderror                      geometry</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;POLYGON [°]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1             381.                      2.43 ((0.8 4, 0.8 4, 1 4, 1.2 4, …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2             262.                      2.10 ((2.8 6, 2.6 6, 2.4 6, 2.2 6…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3             298.                      2.49 ((2.4 3, 2.4 2.8, 2.2 2.8, 2…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4             401.                      2.88 ((4 3.6, 4 3.8, 4 4, 4 4.2, …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5             390.                      2.53 ((1 3.6, 1 3.4, 1.2 3.4, 1.4…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6             357.                      2.15 ((1.6 3, 1.6 2.8, 1.8 2.8, 2…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>     7             203.                      2.40 ((0.6 5, 0.6 5, 0.6 5.2, 0.6…</span></span></code></pre></div>
<p>see the estimated mean (a) and its standard error (b) returned by the
Sandwich mapping model for each of the seven reporting units.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="va">f1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim_est</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sandwichest_mean</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'mean'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#f0bc9c"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sim_est</span><span class="op">$</span><span class="va">sandwichest_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">'right'</span>,</span>
<span>    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'transparent'</span>,color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">f2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim_est</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sandwichest_standarderror</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'se'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#b6edf0"</span>, high <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sim_est</span><span class="op">$</span><span class="va">sandwichest_standarderror</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">'right'</span>,</span>
<span>    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'transparent'</span>,color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">f2</span>, nrow <span class="op">=</span> <span class="fl">1</span>,label_fontfamily <span class="op">=</span> <span class="st">'serif'</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'('</span>,<span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,<span class="st">')'</span><span class="op">)</span>,</span>
<span>          label_fontface <span class="op">=</span> <span class="st">'plain'</span>,label_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          hjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,align <span class="op">=</span> <span class="st">'hv'</span><span class="op">)</span>  <span class="op">-&gt;</span> <span class="va">p</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="sandwich_files/figure-html/sandwich_sim_est-1.png" width="912"></p>
<div class="section level4">
<h4 id="run-sandwich-model-for-the-sim-data-use-population-weight">Run sandwich model for the sim data use <code>population</code>
weight<a class="anchor" aria-label="anchor" href="#run-sandwich-model-for-the-sim-data-use-population-weight"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sandwich.html">sandwich</a></span><span class="op">(</span>sampling <span class="op">=</span> <span class="va">sampling</span>,stratification <span class="op">=</span> <span class="va">ssh</span>,reporting <span class="op">=</span> <span class="va">reporting</span>,</span>
<span>         sampling_attr <span class="op">=</span> <span class="st">'Value'</span>,ssh_zone <span class="op">=</span> <span class="st">'X'</span>,reporting_id <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>         weight_type <span class="op">=</span> <span class="st">'population'</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 7 features and 3 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 5.684342e-14 ymin: 2 xmax: 4 ymax: 6</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">##       Y sandwichest_mean sandwichest_standarderror                      geometry</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;POLYGON [°]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1            <span style="color: #BB0000;">NaN</span>                      <span style="color: #BB0000;">NaN</span>    ((0.8 4, 0.8 4, 1 4, 1.2 4, …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2            266.                       2.11 ((2.8 6, 2.6 6, 2.4 6, 2.2 6…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3            311.                       2.42 ((2.4 3, 2.4 2.8, 2.2 2.8, 2…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4            413.                       3.06 ((4 3.6, 4 3.8, 4 4, 4 4.2, …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5            <span style="color: #BB0000;">NaN</span>                      <span style="color: #BB0000;">NaN</span>    ((1 3.6, 1 3.4, 1.2 3.4, 1.4…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6            <span style="color: #BB0000;">NaN</span>                      <span style="color: #BB0000;">NaN</span>    ((1.6 3, 1.6 2.8, 1.8 2.8, 2…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>     7             93.8                      2.85 ((0.6 5, 0.6 5, 0.6 5.2, 0.6…</span></span></code></pre></div>
<p>Remember to use <code>population</code> weighting when the sample
size is large enough, otherwise use <code>area</code> weighting.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://spatlyu.github.io/" class="external-link">Wenbo Lv</a>, Yangyang Lei.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
